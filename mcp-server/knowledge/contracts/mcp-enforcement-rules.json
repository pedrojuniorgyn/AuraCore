{
  "id": "mcp-enforcement-rules-v2",
  "title": "MCP Enforcement Rules - Mandatory Compliance",
  "version": "2.0.0",
  "category": "governance",
  "description": "Regras de enforcement que DEVEM ser seguidas em 100% das implementacoes. Violacao resulta em rejeicao do codigo.",
  "severity": "CRITICAL",
  "enforcement_level": "MANDATORY",
  "pre_implementation_requirements": {
    "description": "O agente DEVE executar estas acoes ANTES de escrever qualquer codigo",
    "actions": [
      {
        "order": 1,
        "action": "Consultar infrastructure-layer.json",
        "tool": "get_contract",
        "args": { "contract_id": "infrastructure-layer" },
        "reason": "Contem 10 regras obrigatorias para Infrastructure Layer"
      },
      {
        "order": 2,
        "action": "Consultar known-bugs-registry.json",
        "tool": "get_contract",
        "args": { "contract_id": "known-bugs-registry" },
        "reason": "Contem bugs conhecidos que DEVEM ser evitados"
      },
      {
        "order": 3,
        "action": "Verificar estrutura de Value Objects/Entities existentes",
        "tool": "view",
        "args": { "path": "[arquivo relevante]" },
        "reason": "Evitar erros de propriedades inexistentes"
      }
    ],
    "confirmation_required": true
  },
  "critical_rules": [
    {
      "id": "ENFORCE-001",
      "name": "Zero any",
      "description": "Uso de 'any' e PROIBIDO em qualquer circunstancia",
      "detection": "grep -r 'as any' src/",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-002",
      "name": "Money com currency",
      "description": "Money.create() DEVE sempre receber 2 parametros (amount, currency)",
      "detection": "Buscar Money.create com apenas 1 parametro",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-003",
      "name": "Multi-tenancy completo",
      "description": "TODOS os metodos de Repository DEVEM filtrar por organizationId E branchId",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-004",
      "name": "branchId obrigatorio",
      "description": "branchId NUNCA pode ser opcional em interfaces de filter",
      "detection": "grep -r 'branchId?' src/",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-005",
      "name": "Reconstitute vs Create",
      "description": "Ao carregar do banco, DEVE usar reconstitute(), nao create()",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-006",
      "name": "UPDATE completo",
      "description": "Metodo save() UPDATE DEVE atualizar TODOS os campos mutaveis",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-007",
      "name": "Schema completo",
      "description": "Schema Drizzle DEVE ter TODOS os campos do Domain Model",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-008",
      "name": "Campos opcionais nullable",
      "description": "Campos opcionais do Domain DEVEM ser .nullable() no Schema",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-009",
      "name": "Bootstrap registrado",
      "description": "initializeModule() DEVE ser chamado em instrumentation.ts",
      "violation_action": "REJEITAR codigo"
    },
    {
      "id": "ENFORCE-010",
      "name": "Testes obrigatorios",
      "description": "Cada camada DEVE ter testes minimos antes de commit",
      "minimum_tests": {
        "domain_aggregate": 5,
        "domain_value_object": 3,
        "application_use_case": 3,
        "infrastructure_mapper": 5,
        "infrastructure_repository": 5,
        "presentation_route": 2
      },
      "violation_action": "REJEITAR commit"
    },
    {
      "id": "ENFORCE-011",
      "name": "TypeScript deve compilar sem erros",
      "description": "Antes de reportar conclusao, o codigo DEVE compilar sem erros TypeScript",
      "validation_command": "npx tsc --noEmit",
      "expected_result": "exit code 0, zero erros",
      "when_to_run": "ANTES de fazer commit, ANTES de reportar conclusao",
      "violation_action": "NAO REPORTAR como concluido ate corrigir todos os erros",
      "notes": [
        "Erros em arquivos de semanas anteriores TAMBEM devem ser corrigidos",
        "Nao e aceitavel reportar 'X erros restantes em arquivos de Week N'",
        "O projeto inteiro deve compilar limpo"
      ]
    },
    {
      "id": "ENFORCE-012",
      "name": "Verificar estrutura antes de usar",
      "description": "Antes de acessar propriedades de Value Objects ou Entities, DEVE verificar a estrutura real do arquivo",
      "violation_example": "Acessar group.classificacaoTributaria quando a propriedade real e group.classificationCode",
      "prevention": "Ler o arquivo do Value Object/Entity antes de usar suas propriedades",
      "violation_action": "REJEITAR codigo com propriedades inexistentes"
    },
    {
      "id": "ENFORCE-013",
      "name": "Commit unico por feature",
      "description": "Cada feature/fix deve ter UM commit limpo, nao multiplos commits de correcao",
      "violation_example": "3 commits: 'fix: X', 'fix: corrigir X', 'fix: corrigir X de novo'",
      "correct_example": "1 commit: 'feat: implementar X' (testado e funcionando)",
      "prevention": "Testar TUDO antes do primeiro commit",
      "violation_action": "Squash commits antes de reportar"
    }
  ],
  "pre_commit_checklist": {
    "description": "DEVE executar ANTES de fazer commit",
    "commands": [
      {
        "order": 1,
        "command": "npx tsc --noEmit",
        "expected": "0 erros",
        "blocking": true
      },
      {
        "order": 2,
        "command": "npm test",
        "expected": "todos passando, 0 skipped",
        "blocking": true
      },
      {
        "order": 3,
        "command": "grep -r 'as any' src/",
        "expected": "0 resultados",
        "blocking": true
      },
      {
        "order": 4,
        "tool": "check_cursor_issues",
        "expected": "0 issues",
        "blocking": true
      }
    ]
  },
  "post_implementation_report_format": {
    "description": "Formato obrigatorio para reportar conclusao",
    "template": [
      "SEMANA X - CONCLUIDA",
      "",
      "Verificacoes pre-commit:",
      "- npx tsc --noEmit: 0 erros",
      "- npm test: X/X passando",
      "- grep 'as any': 0 resultados", 
      "- check_cursor_issues: 0 issues",
      "",
      "Arquivos: X criados, X modificados",
      "Testes novos: X",
      "Commit: [hash unico]",
      "",
      "NAO FOI FEITO PUSH. Aguardando aprovacao."
    ],
    "forbidden_phrases": [
      "X erros restantes",
      "erros em arquivos de Week anterior",
      "sera corrigido depois",
      "fora do escopo"
    ]
  },
  "push_rules": {
    "push_allowed": false,
    "requires_approval": true,
    "approval_phrase": "APROVADO - FAZER PUSH",
    "violation_action": "Push sem aprovacao resulta em advertencia"
  }
}