{
  "epic": "P1.B - Notifications Input Validation Round 3",
  "corrections": [
    {
      "id": "LC-615301",
      "date": "2026-01-23",
      "epic": "P1.B - Notifications Input Validation Round 3",
      "error": "BUG-007: POST /api/notifications usava body JSON sem validação Zod. notificationId podia ser string ao invés de number, causando comportamento inesperado. Service fazia conversão defensiva Number(notificationId) que escondia o problema de validação ausente. Violação do pattern: Route valida → Service processa.",
      "correction": "1. Adicionado Zod schema MarkNotificationSchema com validação: notificationId deve ser number.int().positive() e refine para garantir markAll ou notificationId presente. 2. POST handler agora valida com safeParse() ANTES de processar, retornando 400 com detalhes de erros. 3. Removido Number() defensivo do service - não é responsabilidade dele. 4. Criado contrato INPUT_VALIDATION_CONTRACT.md documentando o pattern para futuros endpoints.",
      "files_affected": [
        "src/app/api/notifications/route.ts",
        "src/services/notification-service.ts",
        "docs/architecture/contracts/INPUT_VALIDATION_CONTRACT.md"
      ],
      "pattern_created": "zod-input-validation-api-routes",
      "status": "APPROVED",
      "must_not_repeat": true
    }
  ]
}