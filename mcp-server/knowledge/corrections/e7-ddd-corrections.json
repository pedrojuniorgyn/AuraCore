{
  "epic": "E7-DDD",
  "corrections": [
    {
      "id": "LC-041712",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.0: Setup + Infraestrutura de Testes - Criar estrutura base para migração DDD/Hexagonal Híbrido",
      "correction": "Estrutura modular criada (src/modules/{financial,accounting,fiscal,tms,wms} + src/shared/domain + infrastructure + tests/), tsyringe configurado com TOKENS e container, Result<T,E> pattern implementado, AggregateRoot/Entity/ValueObject/DomainEvent/DomainError classes base implementadas, Vitest configurado com 80% coverage threshold + setup helpers + InMemoryRepository base, scripts npm (test, test:ui, test:coverage, test:watch) adicionados",
      "files_affected": [
        "src/shared/domain/types/Result.ts",
        "src/shared/domain/entities/AggregateRoot.ts",
        "src/shared/domain/entities/Entity.ts",
        "src/shared/domain/entities/ValueObject.ts",
        "src/shared/domain/events/DomainEvent.ts",
        "src/shared/domain/errors/DomainError.ts",
        "src/shared/infrastructure/di/tokens.ts",
        "src/shared/infrastructure/di/container.ts",
        "src/shared/infrastructure/di/index.ts",
        "src/shared/domain/index.ts",
        "src/shared/index.ts",
        "vitest.config.ts",
        "tests/setup.ts",
        "tests/helpers/mocks/repositories/InMemoryRepository.ts",
        "package.json"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-262670",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.1 Parcial: Value Objects Money, CNPJ, Email com testes completos + correções de ambiente (crypto.randomUUID fallback, vitest node_modules exclusion, Email trim)",
      "correction": "Implementados 3 Value Objects com TDD: Money (22 testes - operações monetárias, formatação pt-BR, conversão cents), CNPJ (10 testes - validação dígitos verificadores brasileiros), Email (12 testes - validação formato, domain, localPart). Corrigido crypto.randomUUID em DomainEvent com fallback para getRandomValues e Math.random. Corrigido vitest.config para excluir node_modules. Corrigido Email para trim ANTES de validar. 100% type-safe, zero any, todas interfaces satisfazem Record<string, unknown> constraint.",
      "files_affected": [
        "src/shared/domain/value-objects/Money.ts",
        "src/shared/domain/value-objects/CNPJ.ts",
        "src/shared/domain/value-objects/Email.ts",
        "src/shared/domain/value-objects/index.ts",
        "src/shared/domain/events/DomainEvent.ts",
        "tests/unit/shared/value-objects/Money.test.ts",
        "tests/unit/shared/value-objects/CNPJ.test.ts",
        "tests/unit/shared/value-objects/Email.test.ts",
        "vitest.config.ts"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-662125",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.0 + E7.1 COMPLETOS: Setup + Shared Kernel + Value Objects + Documentação Arquitetural - Marco histórico da fundação DDD do AuraCore",
      "correction": "Infraestrutura DDD completa criada: Result<T,E> pattern, AggregateRoot, Entity, ValueObject, DomainEvent (com generateUUID fallback), DomainError hierarchy. Value Objects implementados com TDD: Money (25 testes - operações monetárias, formatação pt-BR, conversão cents, bug Money.zero() corrigido), CNPJ (10 testes - validação dígitos verificadores brasileiros), Email (12 testes - validação formato, lowercase, trim). Vitest configurado (80% coverage threshold), InMemoryRepository helper criado. Documentação arquitetural completa de 376 linhas (E7_DDD_HEXAGONAL_HIBRIDO.md) com filosofia híbrida, estrutura de pastas, camadas, cronograma 21 semanas, estratégia de testes. 100% type-safe, zero any, TDD aplicado, 47 testes passando.",
      "files_affected": [
        "src/shared/domain/types/Result.ts",
        "src/shared/domain/entities/AggregateRoot.ts",
        "src/shared/domain/entities/Entity.ts",
        "src/shared/domain/entities/ValueObject.ts",
        "src/shared/domain/events/DomainEvent.ts",
        "src/shared/domain/errors/DomainError.ts",
        "src/shared/domain/value-objects/Money.ts",
        "src/shared/domain/value-objects/CNPJ.ts",
        "src/shared/domain/value-objects/Email.ts",
        "src/shared/domain/value-objects/index.ts",
        "src/shared/domain/index.ts",
        "src/shared/infrastructure/di/tokens.ts",
        "src/shared/infrastructure/di/container.ts",
        "src/shared/infrastructure/di/index.ts",
        "src/shared/index.ts",
        "tests/setup.ts",
        "tests/helpers/mocks/repositories/InMemoryRepository.ts",
        "tests/unit/shared/value-objects/Money.test.ts",
        "tests/unit/shared/value-objects/CNPJ.test.ts",
        "tests/unit/shared/value-objects/Email.test.ts",
        "vitest.config.ts",
        "docs/architecture/E7_DDD_HEXAGONAL_HIBRIDO.md",
        "package.json"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-021765",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.1 100% COMPLETO: Todos os 6 Value Objects implementados com TDD - Shared Kernel robusto",
      "correction": "CPF (13 testes - validação brasileira com dígitos verificadores, formatação XXX.XXX.XXX-XX), DateRange (18 testes - intervalos de data com overlaps, contains, encompasses, duration em dias/meses), TaxRate (24 testes - taxas 0-100%, factories para impostos brasileiros IRRF/PIS/COFINS/CSLL/ISS, cálculo sobre Money). Total E7.1: 6 Value Objects (Money, CNPJ, CPF, Email, DateRange, TaxRate), 102 testes passando, 100% type-safe, zero any, TDD aplicado.",
      "files_affected": [
        "src/shared/domain/value-objects/CPF.ts",
        "src/shared/domain/value-objects/DateRange.ts",
        "src/shared/domain/value-objects/TaxRate.ts",
        "src/shared/domain/value-objects/index.ts",
        "src/shared/domain/index.ts",
        "tests/unit/shared/value-objects/CPF.test.ts",
        "tests/unit/shared/value-objects/DateRange.test.ts",
        "tests/unit/shared/value-objects/TaxRate.test.ts"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-831547",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.1 MARCO: Shared Kernel 100% completo - 6 Value Objects, 102 testes, base DDD sólida",
      "correction": "Money (25 testes), CNPJ (10), CPF (13), Email (12), DateRange (18), TaxRate (24). Factories brasileiras implementadas: IRRF (1.5%), PIS (0.65%), COFINS (3%), CSLL (1%), ISS (customizável). Infraestrutura DDD completa: Result<T,E> pattern, AggregateRoot, Entity, ValueObject, DomainEvent (com generateUUID fallback), DomainError hierarchy. Vitest configurado (80% threshold), InMemoryRepository, 100% type-safe. Base sólida para E7.2 Financial e demais módulos de negócio.",
      "files_affected": [
        "src/shared/domain/value-objects/Money.ts",
        "src/shared/domain/value-objects/CNPJ.ts",
        "src/shared/domain/value-objects/CPF.ts",
        "src/shared/domain/value-objects/Email.ts",
        "src/shared/domain/value-objects/DateRange.ts",
        "src/shared/domain/value-objects/TaxRate.ts",
        "src/shared/domain/types/Result.ts",
        "src/shared/domain/entities/AggregateRoot.ts",
        "src/shared/domain/entities/Entity.ts",
        "src/shared/domain/entities/ValueObject.ts",
        "src/shared/domain/events/DomainEvent.ts",
        "src/shared/domain/errors/DomainError.ts",
        "tests/unit/shared/value-objects/Money.test.ts",
        "tests/unit/shared/value-objects/CNPJ.test.ts",
        "tests/unit/shared/value-objects/CPF.test.ts",
        "tests/unit/shared/value-objects/Email.test.ts",
        "tests/unit/shared/value-objects/DateRange.test.ts",
        "tests/unit/shared/value-objects/TaxRate.test.ts",
        "vitest.config.ts",
        "docs/architecture/E7_DDD_HEXAGONAL_HIBRIDO.md"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-652573",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.2 Semana 1: Domain Entities Financial - AccountPayable, Payment, PaymentTerms com comportamento rico e testes",
      "correction": "Aggregate Root AccountPayable com ciclo de vida completo (OPEN→PROCESSING→PARTIAL→PAID/CANCELLED), registerPayment() com validações e eventos, cancel() com propagação para payments. Entity Payment com confirm()/cancel(). Value Object PaymentTerms com cálculo automático de multa (2% default), juros pro-rata diário (1%/mês default), desconto por antecipação. Domain Events: PayableCreatedEvent, PaymentCompletedEvent, PayableCancelledEvent. Repository Interface IPayableRepository (Port) com métodos CRUD + findOverdue. 7 testes unitários passando com TDD. Bug corrigido: teste usava data vencida causando cálculo de multa/juros inesperado.",
      "files_affected": [
        "src/modules/financial/domain/entities/AccountPayable.ts",
        "src/modules/financial/domain/entities/Payment.ts",
        "src/modules/financial/domain/entities/index.ts",
        "src/modules/financial/domain/value-objects/PaymentTerms.ts",
        "src/modules/financial/domain/value-objects/index.ts",
        "src/modules/financial/domain/events/PayableEvents.ts",
        "src/modules/financial/domain/events/index.ts",
        "src/modules/financial/domain/errors/FinancialErrors.ts",
        "src/modules/financial/domain/errors/index.ts",
        "src/modules/financial/domain/ports/output/IPayableRepository.ts",
        "src/modules/financial/domain/ports/output/index.ts",
        "src/modules/financial/domain/index.ts",
        "tests/unit/modules/financial/domain/entities/AccountPayable.test.ts"
      ],
      "pattern_created": null,
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-069209",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.2 SEMANA 2 MARCO: Application Layer completa - 5 Use Cases, 3 DTOs, multi-tenancy, 11 testes",
      "correction": "CreatePayableUseCase, PayAccountPayableUseCase, CancelPayableUseCase, ListPayablesUseCase, GetPayableByIdUseCase. DTOs com Zod validation. ExecutionContext para multi-tenancy. Branch scoping (admin vs user). Dependency Injection com tsyringe. 11 testes passando.",
      "files_affected": [
        "src/modules/financial/application/use-cases/CreatePayableUseCase.ts",
        "src/modules/financial/application/use-cases/PayAccountPayableUseCase.ts",
        "src/modules/financial/application/use-cases/CancelPayableUseCase.ts",
        "src/modules/financial/application/use-cases/ListPayablesUseCase.ts",
        "src/modules/financial/application/use-cases/GetPayableByIdUseCase.ts",
        "src/modules/financial/application/dtos/CreatePayableDTO.ts",
        "src/modules/financial/application/dtos/PayAccountPayableDTO.ts",
        "src/modules/financial/application/dtos/PayableResponseDTO.ts"
      ],
      "pattern_created": "E7.2 Week 2 Complete - Application Layer Marco",
      "status": "APPROVED",
      "must_not_repeat": true
    },
    {
      "id": "LC-900194",
      "date": "2025-12-28",
      "epic": "E7-DDD",
      "error": "E7.2 Semana 3: Infrastructure Layer - DrizzlePayableRepository, Mapper, EventDispatcher, DI Module",
      "correction": "DrizzlePayableRepository implementa IPayableRepository com Drizzle ORM. PayableMapper converte Domain<->Persistence. DomainEventDispatcher para eventos. FinancialModule registra todas dependências no container tsyringe. Schemas Drizzle para accounts_payable e payments. Usado char(36) para UUIDs ao invés de uniqueIdentifier. Usado sql`GETDATE()` ao invés de defaultNow(). Usado queryPaginated helper para .limit(). Implementado upsert manual (check + update/insert) pois mssql não suporta onConflictDoUpdate. 3 testes do Mapper passando.",
      "files_affected": [
        "src/modules/financial/infrastructure/persistence/DrizzlePayableRepository.ts",
        "src/modules/financial/infrastructure/persistence/PayableMapper.ts",
        "src/modules/financial/infrastructure/persistence/PayableSchema.ts",
        "src/modules/financial/infrastructure/events/DomainEventDispatcher.ts",
        "src/modules/financial/infrastructure/di/FinancialModule.ts",
        "tests/unit/modules/financial/infrastructure/persistence/PayableMapper.test.ts"
      ],
      "pattern_created": "E7.2 Week 3 - Infrastructure Layer with Repository, Mapper, Events, DI",
      "status": "APPROVED",
      "must_not_repeat": true
    }
  ]
}