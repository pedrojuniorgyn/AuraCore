{
  "id": "0016-e715-type-safety",
  "number": "0016",
  "title": "E7.15 - Enterprise Type Safety",
  "type": "adr",
  "status": "Aceito",
  "context": "O projeto AuraCore tinha ~706 erros TypeScript e ~104 erros ESLint, comprometendo a qualidade e manutenibilidade do código. A decisão de eliminar todos os erros foi tomada para garantir type safety completa e padrões consistentes.",
  "decision": "Eliminar TODOS os erros TypeScript e ESLint através de correções sistemáticas seguindo padrões consistentes:\n\n1. Error Handling: `catch (error: unknown)` com `instanceof Error`\n2. Type Assertions: Usar type assertions específicas para response bodies\n3. Multi-tenancy: branchId NUNCA opcional, validar antes de uso\n4. Operador Precedence: Usar parênteses com `??` em comparações: `(value ?? 0) >= 0`\n5. Variáveis não usadas: Prefixar com underscore `_variable`",
  "consequences": "**Positivas:**\n- Zero erros TypeScript em todo o codebase\n- Zero erros ESLint (warnings permitidos)\n- Código mais seguro e manutenível\n- Padrões consistentes em ~200 arquivos\n- Base sólida para próximas features\n\n**Negativas:**\n- Algumas type assertions podem mascarar erros reais (mitigado com testes)\n- Uso controlado de `as any` em casos específicos de Drizzle\n- Tempo de desenvolvimento: ~2 semanas com 2 agentes\n\n**Trade-offs:**\n- Preferência por type safety explícita vs inferência automática\n- Type assertions inline vs interfaces globais (escolhido inline para testes)",
  "content": "# ADR-0016: E7.15 - Enterprise Type Safety\n\n## Status\nAceito\n\n## Contexto\nO projeto AuraCore tinha ~706 erros TypeScript e ~104 erros ESLint, comprometendo a qualidade e manutenibilidade do código.\n\n## Decisão\nEliminar TODOS os erros TypeScript e ESLint através de correções sistemáticas seguindo padrões consistentes.\n\n## Padrões Estabelecidos\n\n### 1. Error Handling\n```typescript\n// ✅ CORRETO\ntry {\n  // código\n} catch (error: unknown) {\n  const message = error instanceof Error ? error.message : String(error);\n  console.error('Erro:', message);\n}\n\n// ❌ ERRADO\ntry {\n  // código\n} catch (error: any) {  // any não permitido\n  console.error(error.message);  // unsafe\n}\n```\n\n### 2. Type Assertions para Responses\n```typescript\n// ✅ CORRETO - Response de API mock\nconst id = (response.body as { id: string }).id;\nconst items = (response.body as { items: Array<T> }).items;\n\n// ❌ ERRADO\nconst id = response.body.id;  // body é Record<string, unknown>\n```\n\n### 3. branchId NUNCA opcional\n```typescript\n// ✅ CORRETO\nif (!ctx.branchId) {\n  return NextResponse.json(\n    { error: 'branchId obrigatório' },\n    { status: 400 }\n  );\n}\n\n// ❌ ERRADO\nconst branchId = ctx.branchId ?? 0;  // mascarar erro\n```\n\n### 4. Operador Precedence\n```typescript\n// ✅ CORRETO\nif ((value ?? 0) >= 0) { ... }\n\n// ❌ ERRADO\nif (value ?? 0 >= 0) { ... }  // parsed como: value ?? (0 >= 0)\n```\n\n### 5. Variáveis Não Usadas\n```typescript\n// ✅ CORRETO\nconst { _organizationId, branchId } = ctx;  // _organizationId não usado\n\n// ❌ ERRADO\nconst { organizationId, branchId } = ctx;  // ESLint error\n```\n\n## Consequências\n\n### Positivas\n- Zero erros TypeScript\n- Zero erros ESLint\n- Código mais seguro e manutenível\n- Padrões consistentes\n- Base sólida para features futuras\n\n### Negativas\n- Algumas type assertions podem mascarar erros reais\n- Uso de `as any` em casos específicos de Drizzle\n- Tempo investido: ~2 semanas\n\n### Bugs Corrigidos Durante o Processo\n1. Loop infinito em useEffect (grouped-sidebar.tsx)\n2. Campo incorreto netIncome vs netProfit (dre/page.tsx)\n3. Comparação de array vs number (categories/route.ts)\n4. Remoção acidental de REVENUE filter (categorias/page.tsx)\n\n## Métricas\n\n| Métrica | Antes | Depois | Redução |\n|---------|-------|--------|----------|\n| TypeScript Errors | ~706 | 0 | 100% |\n| ESLint Errors | ~104 | 0 | 100% |\n| Arquivos Modificados | - | ~200 | - |\n| Commits | - | ~50 | - |\n\n## Referências\n- E7.15 Epic Documentation\n- TypeScript Strict Mode Guidelines\n- ESLint Best Practices\n- regrasmcp.mdc - Regras MCP Obrigatórias\n",
  "metadata": {
    "sourceFile": "docs/architecture/adr/0016-e715-type-safety.md",
    "createdAt": "2026-01-10T14:00:00.000Z",
    "version": "1.0.0",
    "epic": "E7.15",
    "phase": "7.12",
    "authors": ["Chat 1 (Agent)", "Chat 2 (Agent)"],
    "reviewedBy": "Pedro Lemes"
  }
}
