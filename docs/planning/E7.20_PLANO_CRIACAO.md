# E7.20 - Plano de Cria√ß√£o de Input Ports

**Data:** 14/01/2026  
**√âpico:** E7 - Melhoria Cont√≠nua  
**Tipo:** Plano de Implementa√ß√£o Arquitetural

---

## üìä Vis√£o Geral

Este documento define o plano completo para criar **51 Input Ports** em 4 m√≥dulos (Financial, Accounting, Fiscal, WMS), eliminando 100% do gap arquitetural identificado no **E7.20_ANALISE_INPUT_PORTS.md**.

### Objetivos

1. ‚úÖ Criar `domain/ports/input/` em todos os m√≥dulos
2. ‚úÖ Definir 51 interfaces de Input Port (1 por Use Case)
3. ‚úÖ Use Cases implementam suas respectivas interfaces
4. ‚úÖ Atualizar DI para registrar interfaces ‚Üí implementa√ß√µes
5. ‚úÖ Refatorar WMS/TMS para usar estrutura `ports/output/`
6. ‚úÖ Garantir conformidade com ARCH-010

---

## üéØ Estrat√©gia de Implementa√ß√£o

### Abordagem: Modular e Incremental

**Princ√≠pios:**
- ‚úÖ **1 m√≥dulo por vez** (minimizar impacto)
- ‚úÖ **Commit por m√≥dulo** (rastreabilidade)
- ‚úÖ **Testes ap√≥s cada m√≥dulo** (valida√ß√£o)
- ‚úÖ **Prioridade por criticidade de neg√≥cio** (risco)

### Ordem de Prioridade

| Ordem | M√≥dulo | Use Cases | Tempo Estimado | Criticidade | Justificativa |
|-------|--------|-----------|----------------|-------------|---------------|
| 1¬∫ | **Financial** | 11 | 3-4h | üî¥ CR√çTICA | T√≠tulos financeiros, risco de duplica√ß√£o |
| 2¬∫ | **Fiscal** | 16 | 5-6h | üî¥ CR√çTICA | Multas SEFAZ, SPED (R$ 5.000+) |
| 3¬∫ | **Accounting** | 7 | 2-3h | üü° ALTA | Dependente de Financial |
| 4¬∫ | **WMS** | 17 | 5-6h | üü° M√âDIA | Operacional, refatorar estrutura ports/ |
| - | **TMS** | 0 | 0h | üü¢ BAIXA | Aguardar implementa√ß√£o de Use Cases |

**Tempo Total Estimado:** 15-19 horas

---

## üìã Checklist por M√≥dulo

### Fase 1: Prepara√ß√£o

- [ ] Criar pasta `domain/ports/input/`
- [ ] Criar arquivo `domain/ports/input/index.ts`
- [ ] (WMS/TMS) Mover ports para `domain/ports/output/`

### Fase 2: Cria√ß√£o de Interfaces

- [ ] Criar 1 arquivo por Input Port: `I{UseCase}.ts`
- [ ] Definir interface com m√©todo `execute()`
- [ ] Definir tipos `{UseCase}Input` e `{UseCase}Output`
- [ ] Adicionar JSDoc com descri√ß√£o de neg√≥cio
- [ ] Exportar em `index.ts`

### Fase 3: Implementa√ß√£o

- [ ] Use Case implementa Input Port: `implements I{UseCase}`
- [ ] Remover `implements IUseCaseWithContext` (gen√©rica)
- [ ] Verificar assinatura de `execute()` compat√≠vel

### Fase 4: Dependency Injection

- [ ] Atualizar DI container: `container.register<IInterface>('IInterface', { useClass: UseCase })`
- [ ] Atualizar Controllers/dependentes: `@inject('IInterface') useCase: IInterface`
- [ ] Verificar TOKENS (se usar enum de tokens)

### Fase 5: Valida√ß√£o

- [ ] `npx tsc --noEmit` = 0 erros
- [ ] Testes unit√°rios passam
- [ ] Rotas API funcionam
- [ ] Commit m√≥dulo

---

## üî∑ 1. M√≥dulo Financial (11 Input Ports)

### Tempo Estimado: 3-4 horas

### Input Ports a Criar

| # | Arquivo | Interface | Use Case | Tipo |
|---|---------|-----------|----------|------|
| 1 | `ICancelPayable.ts` | `ICancelPayable` | `CancelPayableUseCase` | Command |
| 2 | `ICreatePayable.ts` | `ICreatePayable` | `CreatePayableUseCase` | Command |
| 3 | `IGeneratePayableTitle.ts` | `IGeneratePayableTitle` | `GeneratePayableTitleUseCase` | Command |
| 4 | `IGenerateReceivableTitle.ts` | `IGenerateReceivableTitle` | `GenerateReceivableTitleUseCase` | Command |
| 5 | `IPayAccountPayable.ts` | `IPayAccountPayable` | `PayAccountPayableUseCase` | Command |
| 6 | `IReverseTitles.ts` | `IReverseTitles` | `ReverseTitlesUseCase` | Command |
| 7 | `IApproveExpenseReport.ts` | `IApproveExpenseReport` | `ApproveExpenseReportUseCase` | Command |
| 8 | `IRejectExpenseReport.ts` | `IRejectExpenseReport` | `RejectExpenseReportUseCase` | Command |
| 9 | `ISubmitExpenseReport.ts` | `ISubmitExpenseReport` | `SubmitExpenseReportUseCase` | Command |
| 10 | `IGetPayableById.ts` | `IGetPayableById` | `GetPayableByIdUseCase` | Query |
| 11 | `IListPayables.ts` | `IListPayables` | `ListPayablesUseCase` | Query |

### Exemplo: ICancelPayable.ts

```typescript
// src/modules/financial/domain/ports/input/ICancelPayable.ts

import type { Result } from '@/shared/domain';
import type { ExecutionContext } from '@/shared/domain';

/**
 * Input Port: Cancelar Conta a Pagar
 * 
 * Cancela uma conta a pagar existente, validando permiss√µes e regras de neg√≥cio.
 * 
 * Regras de Neg√≥cio:
 * - Apenas contas com status PENDING podem ser canceladas
 * - Requer permiss√£o 'financial.payables.cancel'
 * - Multi-tenancy: organizationId + branchId obrigat√≥rios
 */
export interface ICancelPayable {
  /**
   * Executa cancelamento de conta a pagar
   * 
   * @param input - Dados de entrada (ID da conta)
   * @param context - Contexto de execu√ß√£o (userId, orgId, branchId)
   * @returns Result com dados da conta cancelada ou mensagem de erro
   */
  execute(
    input: CancelPayableInput,
    context: ExecutionContext
  ): Promise<Result<CancelPayableOutput, string>>;
}

export interface CancelPayableInput {
  /** ID da conta a pagar */
  payableId: string;
  
  /** Motivo do cancelamento (opcional) */
  reason?: string;
}

export interface CancelPayableOutput {
  /** ID da conta cancelada */
  id: string;
  
  /** Novo status (deve ser CANCELLED) */
  status: string;
  
  /** Data de cancelamento */
  cancelledAt: Date;
  
  /** Usu√°rio que cancelou */
  cancelledBy: string;
}
```

### Mudan√ßas no Use Case

```typescript
// src/modules/financial/application/use-cases/CancelPayableUseCase.ts

import { inject, injectable } from 'tsyringe';
import type { ICancelPayable, CancelPayableInput, CancelPayableOutput } from '../../domain/ports/input/ICancelPayable';
import type { IPayableRepository } from '../../domain/ports/output/IPayableRepository';
import { Result } from '@/shared/domain';
import type { ExecutionContext } from '@/shared/domain';

/**
 * Use Case: Cancelar Conta a Pagar
 * 
 * Implementa ICancelPayable (Input Port)
 */
@injectable()
export class CancelPayableUseCase implements ICancelPayable {
  constructor(
    @inject('IPayableRepository') private readonly payableRepo: IPayableRepository
  ) {}

  async execute(
    input: CancelPayableInput,
    context: ExecutionContext
  ): Promise<Result<CancelPayableOutput, string>> {
    // L√≥gica de neg√≥cio permanece inalterada
    // ...
  }
}
```

### Mudan√ßas no DI

```typescript
// src/modules/financial/infrastructure/di/container.ts

import { container } from 'tsyringe';
import type { ICancelPayable } from '../../domain/ports/input/ICancelPayable';
import { CancelPayableUseCase } from '../../application/use-cases/CancelPayableUseCase';
// ... outros imports

export function registerFinancialModule() {
  // Use Cases (Input Ports)
  container.register<ICancelPayable>('ICancelPayable', { useClass: CancelPayableUseCase });
  container.register<ICreatePayable>('ICreatePayable', { useClass: CreatePayableUseCase });
  // ... outros Use Cases
  
  // Repositories (Output Ports) - j√° existem
  container.register<IPayableRepository>('IPayableRepository', { useClass: DrizzlePayableRepository });
  // ...
}
```

### Mudan√ßas no Controller

```typescript
// src/modules/financial/presentation/controllers/PayablesController.ts

import { inject, injectable } from 'tsyringe';
import type { ICancelPayable } from '../../domain/ports/input/ICancelPayable';
import type { IGetPayableById } from '../../domain/ports/input/IGetPayableById';
import type { IListPayables } from '../../domain/ports/input/IListPayables';
import { NextRequest, NextResponse } from 'next/server';

@injectable()
export class PayablesController {
  constructor(
    @inject('ICancelPayable') private readonly cancelPayable: ICancelPayable,
    @inject('IGetPayableById') private readonly getPayableById: IGetPayableById,
    @inject('IListPayables') private readonly listPayables: IListPayables
  ) {}

  async cancel(request: NextRequest, context: ExecutionContext) {
    const body = await request.json();
    const result = await this.cancelPayable.execute(body, context);
    
    if (!Result.isOk(result)) {
      return NextResponse.json({ error: result.error }, { status: 400 });
    }
    
    return NextResponse.json({ data: result.value });
  }
}
```

---

## üî∂ 2. M√≥dulo Fiscal (16 Input Ports)

### Tempo Estimado: 5-6 horas

### Input Ports a Criar

| # | Arquivo | Interface | Use Case | Tipo |
|---|---------|-----------|----------|------|
| 1 | `IAuditTaxTransition.ts` | `IAuditTaxTransition` | `AuditTaxTransitionUseCase` | Query |
| 2 | `IAuthorizeFiscalDocument.ts` | `IAuthorizeFiscalDocument` | `AuthorizeFiscalDocumentUseCase` | Command |
| 3 | `ICalculateCompensation.ts` | `ICalculateCompensation` | `CalculateCompensationUseCase` | Command |
| 4 | `ICalculateIbsCbs.ts` | `ICalculateIbsCbs` | `CalculateIbsCbsUseCase` | Command |
| 5 | `ICalculateTaxes.ts` | `ICalculateTaxes` | `CalculateTaxesUseCase` | Command |
| 6 | `ICancelFiscalDocument.ts` | `ICancelFiscalDocument` | `CancelFiscalDocumentUseCase` | Command |
| 7 | `ICompareTaxRegimes.ts` | `ICompareTaxRegimes` | `CompareTaxRegimesUseCase` | Query |
| 8 | `ICreateFiscalDocument.ts` | `ICreateFiscalDocument` | `CreateFiscalDocumentUseCase` | Command |
| 9 | `IGenerateSpedContributions.ts` | `IGenerateSpedContributions` | `GenerateSpedContributionsUseCase` | Command |
| 10 | `IGenerateSpedEcd.ts` | `IGenerateSpedEcd` | `GenerateSpedEcdUseCase` | Command |
| 11 | `IGenerateSpedFiscal.ts` | `IGenerateSpedFiscal` | `GenerateSpedFiscalUseCase` | Command |
| 12 | `IGetTaxRates.ts` | `IGetTaxRates` | `GetTaxRatesUseCase` | Query |
| 13 | `IProcessTaxCredits.ts` | `IProcessTaxCredits` | `ProcessTaxCreditsUseCase` | Command |
| 14 | `ISimulateTaxScenario.ts` | `ISimulateTaxScenario` | `SimulateTaxScenarioUseCase` | Query |
| 15 | `ISubmitFiscalDocument.ts` | `ISubmitFiscalDocument` | `SubmitFiscalDocumentUseCase` | Command |
| 16 | `IValidateIbsCbsGroup.ts` | `IValidateIbsCbsGroup` | `ValidateIbsCbsGroupUseCase` | Query |

### ‚ö†Ô∏è Aten√ß√£o Especial: SPED Use Cases

Os Use Cases de SPED (11, 12, 13) s√£o **CR√çTICOS** devido a:
- Multas SEFAZ: R$ 5.000/m√™s por arquivo incorreto
- Base Legal: Art. 12 Lei 8.218/91
- Conformidade com layout oficial SPED

**Valida√ß√£o extra obrigat√≥ria:**
```bash
# Ap√≥s implementar Input Ports SPED
grep -rn "IGenerateSped" src/modules/fiscal/application/use-cases/
grep -rn "IGenerateSped" src/modules/fiscal/infrastructure/di/
```

---

## üîµ 3. M√≥dulo Accounting (7 Input Ports)

### Tempo Estimado: 2-3 horas

### Input Ports a Criar

| # | Arquivo | Interface | Use Case | Tipo |
|---|---------|-----------|----------|------|
| 1 | `IAddLineToEntry.ts` | `IAddLineToEntry` | `AddLineToEntryUseCase` | Command |
| 2 | `ICreateJournalEntry.ts` | `ICreateJournalEntry` | `CreateJournalEntryUseCase` | Command |
| 3 | `IGenerateJournalEntry.ts` | `IGenerateJournalEntry` | `GenerateJournalEntryUseCase` | Command |
| 4 | `IPostJournalEntry.ts` | `IPostJournalEntry` | `PostJournalEntryUseCase` | Command |
| 5 | `IReverseJournalEntry.ts` | `IReverseJournalEntry` | `ReverseJournalEntryUseCase` | Command |
| 6 | `IGetJournalEntryById.ts` | `IGetJournalEntryById` | `GetJournalEntryByIdUseCase` | Query |
| 7 | `IListJournalEntries.ts` | `IListJournalEntries` | `ListJournalEntriesUseCase` | Query |

### Depend√™ncia de Financial

Accounting depende de Financial para:
- `GenerateJournalEntryUseCase` escuta eventos de `PayAccountPayableUseCase`
- Partidas dobradas refletem t√≠tulos financeiros

**Ordem de execu√ß√£o obrigat√≥ria:** Financial ‚Üí Accounting

---

## üü¢ 4. M√≥dulo WMS (17 Input Ports + Refatora√ß√£o)

### Tempo Estimado: 5-6 horas

### ‚ö†Ô∏è Refatora√ß√£o de Estrutura (OBRIGAT√ìRIA)

**Antes:**
```
src/modules/wms/domain/ports/
‚îú‚îÄ‚îÄ ILocationRepository.ts
‚îú‚îÄ‚îÄ IMovementRepository.ts
‚îú‚îÄ‚îÄ IStockRepository.ts
‚îî‚îÄ‚îÄ IInventoryCountRepository.ts
```

**Depois:**
```
src/modules/wms/domain/ports/
‚îú‚îÄ‚îÄ input/                              # ‚úÖ CRIAR
‚îÇ   ‚îú‚îÄ‚îÄ ICreateLocation.ts
‚îÇ   ‚îú‚îÄ‚îÄ IRegisterStockEntry.ts
‚îÇ   ‚îú‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ output/                             # ‚úÖ CRIAR (mover para c√°)
    ‚îú‚îÄ‚îÄ ILocationRepository.ts
    ‚îú‚îÄ‚îÄ IMovementRepository.ts
    ‚îú‚îÄ‚îÄ IStockRepository.ts
    ‚îú‚îÄ‚îÄ IInventoryCountRepository.ts
    ‚îî‚îÄ‚îÄ index.ts
```

### Commands (8 Input Ports)

| # | Arquivo | Interface | Use Case |
|---|---------|-----------|----------|
| 1 | `ICompleteInventoryCount.ts` | `ICompleteInventoryCount` | `CompleteInventoryCount` |
| 2 | `ICreateLocation.ts` | `ICreateLocation` | `CreateLocation` |
| 3 | `IDeleteLocation.ts` | `IDeleteLocation` | `DeleteLocation` |
| 4 | `IRegisterStockEntry.ts` | `IRegisterStockEntry` | `RegisterStockEntry` |
| 5 | `IRegisterStockExit.ts` | `IRegisterStockExit` | `RegisterStockExit` |
| 6 | `IStartInventoryCount.ts` | `IStartInventoryCount` | `StartInventoryCount` |
| 7 | `ITransferStock.ts` | `ITransferStock` | `TransferStock` |
| 8 | `IUpdateLocation.ts` | `IUpdateLocation` | `UpdateLocation` |

### Queries (9 Input Ports)

| # | Arquivo | Interface | Use Case |
|---|---------|-----------|----------|
| 1 | `IGetInventoryCountById.ts` | `IGetInventoryCountById` | `GetInventoryCountById` |
| 2 | `IGetLocationById.ts` | `IGetLocationById` | `GetLocationById` |
| 3 | `IGetMovementById.ts` | `IGetMovementById` | `GetMovementById` |
| 4 | `IGetStockByProduct.ts` | `IGetStockByProduct` | `GetStockByProduct` |
| 5 | `IGetStockItemById.ts` | `IGetStockItemById` | `GetStockItemById` |
| 6 | `IListInventoryCounts.ts` | `IListInventoryCounts` | `ListInventoryCounts` |
| 7 | `IListLocations.ts` | `IListLocations` | `ListLocations` |
| 8 | `IListMovements.ts` | `IListMovements` | `ListMovements` |
| 9 | `IListStockItems.ts` | `IListStockItems` | `ListStockItems` |

### Mudan√ßas de Import (Breaking Change)

**Antes:**
```typescript
import type { ILocationRepository } from '../../domain/ports/ILocationRepository';
```

**Depois:**
```typescript
import type { ILocationRepository } from '../../domain/ports/output/ILocationRepository';
```

**Arquivos afetados:**
- `src/modules/wms/application/use-cases/*.ts` (8 arquivos)
- `src/modules/wms/application/use-cases/queries/*.ts` (9 arquivos)
- `src/modules/wms/infrastructure/persistence/repositories/*.ts` (4 arquivos)

**Valida√ß√£o obrigat√≥ria:**
```bash
# Ap√≥s refatora√ß√£o
grep -rn "from '../../domain/ports/I" src/modules/wms/application/
# Deve retornar 0 (todos devem usar ports/output/)
```

---

## üü£ 5. M√≥dulo TMS (Futuro)

### Status: Aguardando Implementa√ß√£o

TMS n√£o tem application layer implementado ainda. Input Ports ser√£o criados em √©pico futuro quando Use Cases forem implementados.

**Refatora√ß√£o necess√°ria:**
```
src/modules/tms/domain/ports/
‚îú‚îÄ‚îÄ IRomaneioRepository.ts          # ‚ùå Atual
```

**Estrutura correta (futura):**
```
src/modules/tms/domain/ports/
‚îú‚îÄ‚îÄ input/                          # Aguardando Use Cases
‚îî‚îÄ‚îÄ output/                         # ‚úÖ Mover IRomaneioRepository para c√°
    ‚îú‚îÄ‚îÄ IRomaneioRepository.ts
    ‚îî‚îÄ‚îÄ index.ts
```

---

## ‚öôÔ∏è Automa√ß√£o e Helpers

### Script de Gera√ß√£o de Input Port (Sugest√£o)

```typescript
// scripts/generate-input-port.ts

/**
 * Script para gerar Input Port a partir de Use Case existente
 * 
 * Uso: npm run generate:input-port -- --module=financial --usecase=CancelPayableUseCase
 */

import * as fs from 'fs';
import * as path from 'path';

interface Options {
  module: string;      // 'financial', 'fiscal', etc
  usecase: string;     // 'CancelPayableUseCase'
}

function generateInputPort(options: Options) {
  const { module, usecase } = options;
  
  // Extrair nome da interface: CancelPayableUseCase ‚Üí ICancelPayable
  const interfaceName = usecase.replace('UseCase', '').replace(/^(.*)$/, 'I$1');
  const fileName = `${interfaceName}.ts`;
  
  // Caminho de destino
  const portPath = path.join(
    process.cwd(),
    'src',
    'modules',
    module,
    'domain',
    'ports',
    'input',
    fileName
  );
  
  // Template
  const template = `// src/modules/${module}/domain/ports/input/${fileName}

import type { Result } from '@/shared/domain';
import type { ExecutionContext } from '@/shared/domain';

/**
 * Input Port: TODO: Adicionar descri√ß√£o
 * 
 * TODO: Adicionar regras de neg√≥cio
 */
export interface ${interfaceName} {
  /**
   * TODO: Adicionar descri√ß√£o do m√©todo
   * 
   * @param input - Dados de entrada
   * @param context - Contexto de execu√ß√£o (multi-tenancy)
   * @returns Result com Output ou mensagem de erro
   */
  execute(
    input: ${interfaceName.substring(1)}Input,
    context: ExecutionContext
  ): Promise<Result<${interfaceName.substring(1)}Output, string>>;
}

export interface ${interfaceName.substring(1)}Input {
  // TODO: Definir campos de entrada
}

export interface ${interfaceName.substring(1)}Output {
  // TODO: Definir campos de sa√≠da
}
`;
  
  // Criar diret√≥rio se n√£o existir
  fs.mkdirSync(path.dirname(portPath), { recursive: true });
  
  // Escrever arquivo
  fs.writeFileSync(portPath, template, 'utf-8');
  
  console.log(`‚úÖ Input Port criado: ${portPath}`);
}

// Executar
const args = process.argv.slice(2);
const module = args.find(a => a.startsWith('--module='))?.split('=')[1];
const usecase = args.find(a => a.startsWith('--usecase='))?.split('=')[1];

if (!module || !usecase) {
  console.error('‚ùå Uso: npm run generate:input-port -- --module=financial --usecase=CancelPayableUseCase');
  process.exit(1);
}

generateInputPort({ module, usecase });
```

### Comandos de Valida√ß√£o

```bash
# 1. Verificar estrutura de ports
find src/modules -name "ports" -type d -exec ls -la {} \;

# 2. Listar Input Ports criados
find src/modules -path "*/domain/ports/input/*.ts" | wc -l

# 3. Verificar Use Cases implementando Input Ports
grep -rn "implements I[A-Z]" src/modules/*/application/use-cases/ --include="*.ts" | wc -l

# 4. Verificar DI registrando interfaces
grep -rn "container.register<I" src/modules/*/infrastructure/di/ --include="*.ts" | wc -l
```

---

## üìä Estimativa Detalhada

### Por M√≥dulo

| M√≥dulo | Input Ports | Tempo/Port | Refatora√ß√£o | Total |
|--------|-------------|------------|-------------|-------|
| Financial | 11 | 15min | - | 3h |
| Fiscal | 16 | 15min | - | 4h |
| Accounting | 7 | 15min | - | 2h |
| WMS | 17 | 15min | 2h | 6h |
| **TOTAL** | **51** | - | **2h** | **15h** |

### Buffer para Imprevistos

- Erros de compila√ß√£o TypeScript: +2h
- Testes falhando: +2h
- Ajustes no DI: +1h

**Tempo Total Realista:** 15h (base) + 5h (buffer) = **20 horas**

### Distribui√ß√£o Sugerida

- **Dia 1:** Financial (3h) + Fiscal (4h) = 7h
- **Dia 2:** Accounting (2h) + WMS parte 1 (4h) = 6h
- **Dia 3:** WMS parte 2 (2h) + Valida√ß√£o e ajustes (5h) = 7h

---

## ‚úÖ Crit√©rios de Aceita√ß√£o

### Por M√≥dulo

- [ ] Pasta `domain/ports/input/` criada
- [ ] Todos os Input Ports criados (1 arquivo por Use Case)
- [ ] Todos os Use Cases implementam Input Port espec√≠fico
- [ ] `npx tsc --noEmit` = 0 erros
- [ ] Testes unit√°rios passam
- [ ] DI registra interfaces ‚Üí classes
- [ ] Controllers/dependentes usam interfaces
- [ ] Commit com mensagem descritiva

### Global

- [ ] 51 Input Ports criados
- [ ] 0 Use Cases sem Input Port
- [ ] ARCH-010 100% em conformidade
- [ ] WMS/TMS com estrutura `ports/output/`
- [ ] Documenta√ß√£o atualizada
- [ ] `check_cursor_issues` = 0

---

## üö® Riscos e Mitiga√ß√µes

### Risco 1: Breaking Changes em WMS

**Problema:** Refatora√ß√£o de `ports/` ‚Üí `ports/output/` quebra imports.

**Impacto:** 21 arquivos afetados.

**Mitiga√ß√£o:**
1. Criar `ports/output/` com arquivos novos
2. Atualizar imports em lote com search-replace
3. Deletar arquivos antigos
4. Validar com TypeScript

### Risco 2: Testes Acoplados a Classes

**Problema:** Testes importam classes diretamente, n√£o interfaces.

**Impacto:** Testes podem falhar ap√≥s mudan√ßas no DI.

**Mitiga√ß√£o:**
1. Revisar imports em testes: `import { UseCase }` ‚Üí `import type { IUseCase }`
2. Usar container de testes com interfaces
3. Mocks implementam interfaces, n√£o classes

### Risco 3: Controllers com Inje√ß√£o Manual

**Problema:** Alguns controllers podem n√£o usar DI.

**Impacto:** N√£o se beneficiam de interfaces.

**Mitiga√ß√£o:**
1. Identificar controllers sem `@injectable()`
2. Refatorar para usar tsyringe
3. Adicionar `@inject()` para depend√™ncias

---

## üìù Template de Commit

```
feat(arch): adicionar Input Ports ao m√≥dulo {Module} - E7.20

Cria√ß√£o de {N} Input Ports para conformidade com ARCH-010.

Input Ports criados:
- I{UseCase1}
- I{UseCase2}
- ...

Mudan√ßas:
- domain/ports/input/*.ts (criados)
- application/use-cases/*.ts (implements I{UseCase})
- infrastructure/di/container.ts (registra interfaces)
- presentation/controllers/*.ts (injeta interfaces)

Conformidade:
- ARCH-010: ‚úÖ Use Cases implementam Input Ports
- TypeScript: 0 erros
- Testes: X/X passando

Closes: E7.20 (parte {Module})
```

---

## üéØ Pr√≥ximos Passos

1. ‚úÖ **An√°lise conclu√≠da** (E7.20_ANALISE_INPUT_PORTS.md)
2. ‚úÖ **Plano criado** (este documento)
3. ‚è≥ **Aprova√ß√£o do plano** (aguardando)
4. ‚è≥ **E7.21: Financial** (1¬∫ m√≥dulo)
5. ‚è≥ **E7.22: Fiscal** (2¬∫ m√≥dulo)
6. ‚è≥ **E7.23: Accounting** (3¬∫ m√≥dulo)
7. ‚è≥ **E7.24: WMS** (4¬∫ m√≥dulo + refatora√ß√£o)

---

## üìö Refer√™ncias

- **E7.20_ANALISE_INPUT_PORTS.md:** Gap analysis completo
- **ADR-0015:** Arquitetura DDD/Hexagonal
- **ARCH-010:** Use Cases implementam Input Ports
- **Vernon, V. (2013):** Implementing Domain-Driven Design (Cap. 4 - Ports and Adapters)

---

**Documento gerado por:** E7.20 - An√°lise Input Ports  
**Data:** 14/01/2026  
**Status:** ‚è≥ Aguardando aprova√ß√£o para E7.21
