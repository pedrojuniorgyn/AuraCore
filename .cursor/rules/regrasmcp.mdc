# AURA CORE - REGRAS OBRIGATÃ“RIAS v2.0

**VersÃ£o:** 2.0.0  
**Data:** 06/01/2026  
**Arquitetura:** 100% DDD/Hexagonal (ADR-0015)

---

## ğŸš¨ MCP OBRIGATÃ“RIO

ANTES de implementar cÃ³digo:

1. Consultar contratos MCP:
   - get_contract("mcp-enforcement-rules")
   - get_contract("architecture-layers")
   - get_contract("schema-pattern")

2. Confirmar: "Contratos MCP consultados. Iniciando implementaÃ§Ã£o."

---

## ğŸ“ ARQUITETURA

### DependÃªncias entre Camadas

| Regra | DescriÃ§Ã£o | Prioridade |
|-------|-----------|------------|
| ARCH-001 | Domain NÃƒO importa de Application | CRÃTICA |
| ARCH-002 | Domain NÃƒO importa de Infrastructure | CRÃTICA |
| ARCH-003 | Domain NÃƒO importa libs externas | CRÃTICA |
| ARCH-004 | Commands em application/commands/ | ALTA |
| ARCH-005 | Queries em application/queries/ | ALTA |
| ARCH-006 | Mappers usam reconstitute(), nÃ£o create() | ALTA |

### Estrutura ObrigatÃ³ria

```
src/modules/{module}/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ value-objects/
â”‚   â”œâ”€â”€ services/           # OBRIGATÃ“RIO
â”‚   â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ errors/
â”‚   â””â”€â”€ ports/
â”‚       â”œâ”€â”€ input/          # OBRIGATÃ“RIO
â”‚       â””â”€â”€ output/         # OBRIGATÃ“RIO
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ commands/           # OBRIGATÃ“RIO
â”‚   â”œâ”€â”€ queries/            # OBRIGATÃ“RIO
â”‚   â””â”€â”€ dtos/
â””â”€â”€ infrastructure/
    â”œâ”€â”€ persistence/
    â”‚   â”œâ”€â”€ repositories/
    â”‚   â”œâ”€â”€ mappers/
    â”‚   â””â”€â”€ schemas/        # 1 por tabela
    â””â”€â”€ di/
```

---

## ğŸ—„ï¸ BANCO DE DADOS

| Regra | DescriÃ§Ã£o |
|-------|-----------|
| SCHEMA-001 | 1 arquivo por tabela |
| SCHEMA-002 | Ãndice (organizationId, branchId) |
| SCHEMA-003 | createdAt, updatedAt obrigatÃ³rios |
| SCHEMA-004 | deletedAt para soft delete |
| SCHEMA-005 | Money = 2 colunas (amount + currency) |
| SCHEMA-006 | Tipos inferidos exportados |

---

## ğŸ”´ REGRAS CRÃTICAS

### TypeScript
- âŒ NUNCA `any`, `@ts-ignore`, `as any`
- âœ… SEMPRE tipar retornos e parÃ¢metros

### Result Pattern
- âœ… Verificar Result.isFail() antes de .value
- âŒ NUNCA throw para erros de negÃ³cio

### Multi-Tenancy
- âœ… SEMPRE organizationId + branchId
- âŒ branchId NUNCA opcional

---

## âœ… PRÃ‰-COMMIT

```bash
npx tsc --noEmit        # 0 erros
npm test -- --run       # Todos passando
check_cursor_issues     # 0 issues
```

---

## ğŸ›¡ï¸ PREVENÃ‡ÃƒO

| Regra | DescriÃ§Ã£o |
|-------|-----------|
| PREVENT-001 | Novo mÃ³dulo segue template |
| PREVENT-002 | Use Case em commands/ ou queries/ |
| PREVENT-003 | CÃ³digo em src/services/ PROIBIDO |
| PREVENT-004 | Domain nÃ£o importa de fora |
| PREVENT-005 | Repository usa Mapper |

---

## ğŸ‡§ğŸ‡· CONTEXTO BRASIL

- LegislaÃ§Ã£o: ICMS, PIS/COFINS, SPED, NFe/CTe
- Reforma 2026: IBS, CBS, IS
- RetenÃ§Ãµes: IRRF 1.5%, PIS 0.65%, COFINS 3%

---

## ğŸ”§ STACK

- Next.js 15, TypeScript, Drizzle, SQL Server 2022
- React 19, Refine, AG Grid, Shadcn/UI
- Vitest, tsyringe

---

**FIM v2.0 - CONSULTAR MCP ANTES DE COMEÃ‡AR**
